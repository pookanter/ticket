FROM cosmtrek/air AS builder

WORKDIR /app

COPY cmd cmd
COPY api/authen api/authen
COPY pkg pkg
COPY go.mod go.sum ./
COPY config config
COPY certs certs
COPY build/authen ./

RUN go mod tidy

FROM cosmtrek/air AS runtime

WORKDIR /app

COPY --from=builder /app .
COPY --from=builder /app/.air.toml .

EXPOSE 4000

CMD ["air", "-c", ".air.toml"]