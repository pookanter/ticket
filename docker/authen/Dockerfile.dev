FROM cosmtrek/air AS builder

WORKDIR /app

COPY . .
COPY air/authen ./

# delete unnecessary files
RUN rm -rf client
RUN rm -rf docker

FROM cosmtrek/air AS runtime

WORKDIR /app

COPY --from=builder /app .
COPY --from=builder /app/.air.toml .

RUN go mod download

EXPOSE 4000

CMD ["air", "-c", ".air.toml"]